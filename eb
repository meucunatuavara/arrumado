local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local Teams = game:GetService("Teams")

local localPlayer = Players.LocalPlayer
local target = nil
local espEnabled = false
local aimbotActive = false 

local aimKey = Enum.KeyCode.E 
local toggleESPKey = Enum.KeyCode.Q
local fovRadius = 50

local targetPart = "Head"

local fovCircle = Drawing.new("Circle")
fovCircle.Visible = false
fovCircle.Color = Color3.new(1, 1, 0)
fovCircle.Thickness = 2
fovCircle.Filled = false
fovCircle.Radius = fovRadius
fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

local function createHighlight(player)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and not player.Character:FindFirstChild("Highlight") then
        local highlight = Instance.new("Highlight")
        highlight.Name = "Highlight"
        highlight.Adornee = player.Character
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0.1
        highlight.Parent = player.Character

        if player.Team then
            highlight.FillColor = player.Team.TeamColor.Color
        else
            highlight.FillColor = Color3.new(1, 0, 0)
        end
    end
end

local function updateESP()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            createHighlight(player)
        end
    end
end

local function removeESP()
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("Highlight") then
            player.Character.Highlight:Destroy()
        end
    end
end

local function findTarget()
    local closestPlayer = nil
    local shortestDistance = math.huge

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild(targetPart) then
            local part = player.Character:FindFirstChild(targetPart)

            if part then
                local screenPosition, onScreen = Camera:WorldToViewportPoint(part.Position)
                local distance = (part.Position - Camera.CFrame.Position).magnitude

                if onScreen and distance < shortestDistance and (Vector2.new(screenPosition.X, screenPosition.Y) - Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)).Magnitude < fovRadius then
                    closestPlayer = player
                    shortestDistance = distance
                    target = player
                end
            end
        end
    end

    return closestPlayer
end

local function aimbot()
    if aimbotActive and target then
        local part = target.Character and target.Character:FindFirstChild(targetPart)
        if part then
            local targetPosition = part.Position
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPosition)
        end
    end
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == aimKey then
        aimbotActive = not aimbotActive -- Alterna o estado do aimbot
        if aimbotActive then
            target = findTarget()
        else
            target = nil
        end
    end

    if input.KeyCode == toggleESPKey then
        espEnabled = not espEnabled
        if espEnabled then
            updateESP()
        else
            removeESP()
        end
    end
end)

RunService.RenderStepped:Connect(function()
    fovCircle.Position = UserInputService:GetMouseLocation()
    if aimbotActive then
        aimbot()
    end
    if espEnabled then
        updateESP()
    end
end)
